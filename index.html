<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="apple-touch-icon" href="/icon-192.png" />
  <title>æˆæœ¬ä¸å”®ä»·è®¡ç®—å™¨ - æƒ…äººä¼ å¥‡</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 15px;
      background-color: #f9f9f9;
      max-width: 800px;
      margin: auto;
      -webkit-text-size-adjust: 100%;
    }
    h1 {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    h1 img { height: 40px; }
    p { text-align: center; color: #666; }

    input, select {
      width: 100%;
      padding: 8px;
      margin: 4px 0;
      box-sizing: border-box;
      font-size: 16px;
    }
    label {
      font-weight: bold;
      font-size: 15px;
    }
    .result {
      margin-top: 12px;
      background: #fff;
      padding: 8px;
      border-radius: 6px;
      box-shadow: 0 0 8px rgba(0,0,0,0.05);
      max-height: 300px;
      overflow-y: auto;
    }

    button {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      background: linear-gradient(to right, #7fbf7f, #4CAF50);
      color: white;
      border: none;
      margin-top: 8px;
      border-radius: 20px;
      cursor: pointer;
      touch-action: manipulation;
    }
    button:hover {
      background: linear-gradient(to right, #6dae6d, #3e9944);
    }

    .row { display: flex; gap: 8px; }
    .row > div { flex: 1; }

    .entry {
      font-size: 15px;
      margin: 4px 0;
      white-space: nowrap;
    }

    /* âœ… å°æŒ‰é’®ï¼šè¦†ç›–å…¨å±€ button æ ·å¼ */
    .mini-btn{
      width: auto !important;
      padding: 4px 8px !important;
      font-size: 14px !important;
      border-radius: 10px !important;
      background: #333 !important;
      color: #fff !important;
      border: none !important;
      cursor: pointer !important;
      margin-top: 0 !important;
      line-height: 1 !important;
      white-space: nowrap !important;
      touch-action: manipulation !important;
    }
  </style>
</head>

<body>
  <h1>
    <img src="Logo2.jpg" alt="æƒ…äººä¼ å¥‡ Logo" />
    æˆæœ¬ä¸å”®ä»·è®¡ç®—å™¨
  </h1>
  <p style="color: red; font-weight: bold; font-size: 26px; letter-spacing: 1px;">
    â€“ Lover Legend Gardening
  </p>

  <div class="row">
    <div style="flex: 2;">
      <label for="price_display" style="display:flex; align-items:center; gap:8px;">
        <span>ç›†æ ½è¿›å£æˆæœ¬ï¼š</span>
        <button type="button" class="mini-btn" onclick="toggleCalc(true)">ğŸ§®</button>
      </label>

      <input
        id="price_display"
        onblur="formatDisplayPrice()"
        oninput="updateRawPrice()"
        type="text"
        placeholder="å¦‚ 1,000.00"
      />
      <input id="price" type="hidden" value="" />
    </div>

    <div style="flex: 1;">
      <label for="currency">è´§å¸ï¼š</label>
      <select id="currency" onchange="setRate()">
        <option selected value="CNY">CNY</option>
        <option value="NTD">NTD</option>
        <option value="VND">VND</option>
        <option value="IDR">IDR</option>
      </select>
    </div>
  </div>

  <div class="row">
    <div>
      <label for="rate">æ±‡ç‡ï¼š</label>
      <input id="rate" type="text" value="1.65" />
    </div>
    <div>
      <label for="freight">æµ·å¤–åˆ°å¤§é©¬è¿è´¹æ¯”ä¾‹ï¼ˆ%ï¼‰ï¼š</label>
      <input id="freight" type="text" value="20%" />
    </div>
  </div>

  <div class="row">
    <div>
      <label for="pot">èŠ±ç›†æˆæœ¬ï¼š</label>
      <input id="pot" type="text" value="0" />
    </div>
    <div>
      <label for="moss">è‹”è—“æˆæœ¬ï¼š</label>
      <input id="moss" type="text" value="0" />
    </div>
  </div>

  <label for="local">æœ¬åœ°è¿è´¹ï¼š
    <span style="color: red; font-weight: bold;">
      ï¼ˆå¦‚æœé’‰æœ¨æ¶ï¼Œè¿è´¹æœ€ä½ 80 èµ·ï¼‰
    </span>
  </label>
  <input id="local" type="text" value="20" />

  <button onclick="calculate()">ğŸŒ± è®¡ç®—</button>

  <div class="result" id="result"></div>

  <!-- âœ… å°è®¡ç®—å™¨å¼¹çª— -->
  <div id="calcModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.35); z-index:9999; touch-action: manipulation;">
    <div id="calcBox" style="
      width:min(360px, 92vw);
      background:#fff;
      border-radius:14px;
      padding:12px;
      margin:12vh auto;
      box-shadow:0 10px 30px rgba(0,0,0,.2);
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      -webkit-user-select: none;
    ">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
        <strong style="font-size:16px;">ğŸ§® è®¡ç®—æœº</strong>
        <button type="button" class="mini-btn" onclick="toggleCalc(false)" style="background:#777 !important;">å…³é—­</button>
      </div>

      <!-- âœ… readonly + inputmode noneï¼šå‡å°‘ iOS åŒå‡»æ”¾å¤§ -->
      <input
        id="calcDisplay"
        type="text"
        readonly
        inputmode="none"
        placeholder="0"
        style="
          width:100%;
          font-size:22px;
          padding:10px;
          border:1px solid #ddd;
          border-radius:10px;
          box-sizing:border-box;
          margin-bottom:10px;
          touch-action: manipulation;
          -webkit-tap-highlight-color: transparent;
          user-select: none;
          -webkit-user-select: none;
        "
      />

      <div style="display:grid; grid-template-columns:repeat(4, 1fr); gap:8px; touch-action: manipulation;">
        <button type="button" onclick="calcKey('7')">7</button>
        <button type="button" onclick="calcKey('8')">8</button>
        <button type="button" onclick="calcKey('9')">9</button>
        <button type="button" onclick="calcKey('/')">Ã·</button>

        <button type="button" onclick="calcKey('4')">4</button>
        <button type="button" onclick="calcKey('5')">5</button>
        <button type="button" onclick="calcKey('6')">6</button>
        <button type="button" onclick="calcKey('*')">Ã—</button>

        <button type="button" onclick="calcKey('1')">1</button>
        <button type="button" onclick="calcKey('2')">2</button>
        <button type="button" onclick="calcKey('3')">3</button>
        <button type="button" onclick="calcKey('-')">âˆ’</button>

        <button type="button" onclick="calcKey('0')">0</button>
        <button type="button" onclick="calcKey('.')">.</button>
        <button type="button" onclick="calcBack()">âŒ«</button>
        <button type="button" onclick="calcKey('+')">+</button>

        <button type="button" onclick="calcKey('(')">(</button>
        <button type="button" onclick="calcKey(')')">)</button>
        <button type="button" onclick="calcKey('%')">%</button>
        <button type="button" onclick="calcClear()">C</button>

        <button type="button" onclick="calcEval()" style="grid-column: span 2; font-weight:bold;">=</button>
        <button type="button" onclick="fillImportCost()" style="grid-column: span 2; font-weight:bold;">å¡«å…¥æˆæœ¬</button>
      </div>

      <style>
        /* âœ… åªå½±å“è®¡ç®—å™¨é‡Œé¢çš„æŒ‰é’® */
        #calcModal button{
          width:auto !important;
          padding:10px !important;
          font-size:16px !important;
          border-radius:10px !important;
          border:1px solid #ddd !important;
          background:#fafafa !important;
          color:#111 !important;
          cursor:pointer !important;
          margin-top:0 !important;
          touch-action: manipulation !important;
          -webkit-tap-highlight-color: transparent !important;
          user-select: none !important;
          -webkit-user-select: none !important;
        }
        #calcModal button:hover{ background:#f0f0f0 !important; }
        #calcModal button:active{ transform: scale(0.98); }
      </style>
    </div>
  </div>

  <script>
    const defaultRates = {
      CNY: 1.65,
      NTD: 1 / 0.135,
      VND: 1 / 0.0001587,
      IDR: 1 / 0.00028
    };

    const defaultFreight = {
      CNY: "20%",
      NTD: "20%",
      VND: "53.78%",
      IDR: "50%"
    };

    const defaultLocal = { CNY: 80, NTD: 20, VND: 20, IDR: 20 };

    // =======================
    // âœ… è®¡ç®—å™¨åŠŸèƒ½
    // =======================
    function toggleCalc(open) {
      const modal = document.getElementById('calcModal');
      modal.style.display = open ? 'block' : 'none';
    }

    function calcKey(k) {
      const d = document.getElementById('calcDisplay');
      d.value = (d.value || '') + k;
    }

    function calcClear() {
      document.getElementById('calcDisplay').value = '';
    }

    function calcBack() {
      const d = document.getElementById('calcDisplay');
      d.value = (d.value || '').slice(0, -1);
    }

    function calcEval() {
      const d = document.getElementById('calcDisplay');
      const expr = (d.value || '').trim();
      if (!expr) return;

      try {
        if (!/^[0-9+\-*/().\s%]+$/.test(expr)) {
          alert('åªå…è®¸è¾“å…¥æ•°å­—å’Œ + - * / ( ) . %');
          return;
        }
        const safeExpr = expr.replace(/(\d+(\.\d+)?)%/g, '($1/100)');
        const result = Function('"use strict"; return (' + safeExpr + ')')();
        if (typeof result === 'number' && isFinite(result)) d.value = result;
        else alert('è®¡ç®—ç»“æœæ— æ•ˆ');
      } catch (e) {
        alert('è¡¨è¾¾å¼æœ‰è¯¯ï¼Œè¯·æ£€æŸ¥');
      }
    }

    function fillImportCost() {
      const d = document.getElementById('calcDisplay');
      const val = parseFloat(d.value);
      if (isNaN(val)) {
        alert('è¯·å…ˆç®—å‡ºä¸€ä¸ªæ•°å­—ç»“æœ');
        return;
      }
      const input = document.getElementById('price_display');
      input.value = String(val);
      formatDisplayPrice();
      toggleCalc(false);
    }

    // =======================
    // âœ… VND èŠ±ç›†æˆæœ¬è‡ªåŠ¨é€»è¾‘
    // =======================
    function autoSetPotVND() {
      const currency = document.getElementById('currency').value;
      const potInput = document.getElementById('pot');

      if (currency !== "VND") {
        potInput.value = "0";
        return;
      }

      const price = parseFloat(document.getElementById('price').value) || 0;

      if (price >= 4000000) {
        potInput.value = "100";
      } else if (price >= 1000000) {
        potInput.value = "50";
      } else {
        potInput.value = "30";
      }
    }

    function setRate() {
      const currency = document.getElementById('currency').value;
      document.getElementById('rate').value = defaultRates[currency].toFixed(6);
      document.getElementById('freight').value = defaultFreight[currency];
      document.getElementById('local').value = defaultLocal[currency];
      autoSetPotVND();
    }

    function updateRawPrice() {
      const input = document.getElementById('price_display');
      const raw = parseFloat(input.value.replace(/,/g, '').replace(/[^\d.]/g, '')) || 0;
      document.getElementById('price').value = raw;
      autoSetPotVND();
    }

    function formatDisplayPrice() {
      const input = document.getElementById('price_display');
      const raw = parseFloat(input.value.replace(/,/g, '').replace(/[^\d.]/g, ''));
      if (!isNaN(raw)) {
        const parts = raw.toFixed(2).split('.');
        parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        input.value = parts.join('.');
      }
      updateRawPrice();
    }

    function calculate() {
      const price = parseFloat(document.getElementById('price').value);
      const freightInput = document.getElementById('freight').value.trim();
      const rate = parseFloat(document.getElementById('rate').value);
      const pot = parseFloat(document.getElementById('pot').value) || 0;
      const moss = parseFloat(document.getElementById('moss').value) || 0;
      const local = parseFloat(document.getElementById('local').value) || 0;

      if (isNaN(price) || isNaN(rate) || rate <= 0) {
        alert('è¯·è¾“å…¥æœ‰æ•ˆçš„è¿›å£æˆæœ¬å•ä»·å’Œæ±‡ç‡');
        return;
      }

      const freight = freightInput === ""
        ? 0.2
        : freightInput.includes('%')
          ? (parseFloat(freightInput.replace('%', '')) / 100)
          : (parseFloat(freightInput) / 100);

      const rmCost = (price / rate) * (1 + freight) + pot + moss + local;

      const prices = {
        "20%": rmCost * 1.26 * 1.12,
        "30%": rmCost * 1.43 * 1.12,
        "40%": rmCost * 1.67 * 1.12,
        "45%": rmCost * 1.82 * 1.12,
        "50%": rmCost * 2.00 * 1.12,
        "55%": rmCost * 2.23 * 1.12,
        "60%": rmCost * 2.51 * 1.12
      };

     const costX3 = rmCost * 3;
let html = `<div class="entry" style="font-size: 20px;">
  <strong>å®é™…æˆæœ¬ï¼š</strong>RM ${rmCost.toFixed(2)}
  <span style="color:red; font-weight:bold;">
    &nbsp;&nbsp;x3: RM ${costX3.toFixed(2)}
  </span>
</div>`;
      html += `<div class="entry" style="font-size: 20px;"><strong>20% åˆ©æ¶¦å”®ä»·ï¼š</strong>RM ${prices["20%"].toFixed(2)}</div>`;
      html += `<div class="entry" style="font-size: 20px; color: #1976d2; font-weight: bold;"><strong>30% æ‰¹å‘å”®ä»·ï¼š</strong>RM ${prices["30%"].toFixed(2)}</div>`;
      html += `<div class="entry" style="font-size: 20px;"><strong>40% åˆ©æ¶¦å”®ä»·ï¼š</strong>RM ${prices["40%"].toFixed(2)}</div>`;
      html += `<div class="entry" style="font-size: 20px; color: #1976d2; font-weight: bold;"><strong>45% ç›´æ’­å”®ä»·ï¼š</strong>RM ${prices["45%"].toFixed(2)}</div>`;
      html += `<div class="entry" style="font-size: 20px; color: red; font-weight: bold;"><strong>50% é—¨å¸‚å”®ä»·ï¼š</strong>RM ${prices["50%"].toFixed(2)}</div>`;

      const price55 = prices["55%"];
      const price55Discount = price55 * 0.8 / 2;
      html += `<div class="entry" style="font-size: 20px;">
        <strong>55% åˆ©æ¶¦å”®ä»·ï¼š</strong>RM ${price55.toFixed(2)}
        <span style="color: #1976d2; font-weight: bold; font-size: 20px;"> / ${price55Discount.toFixed(2)}</span>
      </div>`;

      const price60 = prices["60%"];
      const price60Discount = price60 * 0.75 / 2;
      html += `<div class="entry" style="font-size: 20px; color: red; font-weight: bold;">
        <strong>60% Fairå”®ä»·ï¼š</strong>RM ${price60.toFixed(2)}
        <span style="color: #1976d2; font-weight: bold; font-size: 20px;"> / ${price60Discount.toFixed(2)}</span>
      </div>`;

      html += `<div class="entry" style="font-size: 20px; font-weight: bold; color: #000;">
        ï¼ˆé—¨å¸‚æœ€å¤š -10% ï¼ŒFair æœ€å¤š -25%ï¼‰
      </div>`;

      document.getElementById('result').innerHTML = html;
    }

    window.onload = () => {
      setRate();
      autoSetPotVND();
    };
  </script>
</body>
</html>
